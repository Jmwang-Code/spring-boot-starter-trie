# 1. 整体架构

<img alt="png.png" src="./ps/png.png" width="500"/>

# 2.机制

## 2.1 加载机制

### 2.1.1 原公司加载机制

<img alt="png1.png" src="./ps/png1.png" width="500"/>

连接指定DB
**↓**
配置文件加载
**↓**
前缀树实例化（bean对象已经创建完成）
**↓**
中继日志回放/数据源远程加载
**↓**
前缀树初始化

![png3.png](ps%2Fpng3.png)

### 2.1.2 数据提供者

![png2.png](ps%2Fpng2.png)

使用SPI机制，将接口的实现进行可以切换扩展。从而达到真正的可以将加载模块进行解耦，可以成为一个独立的插件data-provider。

更优雅的结构，在开发运维方向也更好的进行维护，更快速的数据结构和代码优化。

### 2.2 日志先行机制（数据库生命周期）

![png4.png](ps%2Fpng4.png)

由于如果服务挂掉或者机器宕机，导致当前写入数据缺失，下次拉起服务导致数据丢失。

采用日志先行机制，通过多种持久化方法将数据可回放，回复机制。